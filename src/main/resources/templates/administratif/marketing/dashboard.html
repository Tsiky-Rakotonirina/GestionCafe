<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cafeteria</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
          rel="stylesheet">
    <!-- Utilisation de Thymeleaf pour la gestion des ressources CSS -->
    <link rel="stylesheet" th:href="@{/templates/styles.css}">
    <link rel="stylesheet" th:href="@{/css/marketing/dashboard.css}">
</head>
<body>

    <div th:replace="~{administratif/marketing/layout/sidebar :: sidebar}"></div>
    <div class="main-content" id="mainContent">
        <div th:replace="~{administratif/marketing/layout/header :: header('Dashboard Marketing')}"></div>
        
        <main class="content">
            <!-- Page Header -->
            <div class="page-header modern-header">
                <div class="header-content">
                    <div class="header-title-section">
                        <div class="header-icon">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <div>
                            <h2>Dashboard Marketing</h2>
                            <p class="header-subtitle">Analyse et insights des données marketing</p>
                        </div>
                    </div>
                    <div class="header-actions">
                        <button class="btn outline" onclick="window.location.reload()">
                            <i class="fas fa-sync-alt"></i>
                            Actualiser
                        </button>
                        <button class="btn primary">
                            <i class="fas fa-download"></i>
                            Exporter
                        </button>
                    </div>
                </div>
            </div>
            <!-- Stats Grid -->
            <div class="stats-grid" style="margin-bottom: 2rem;">
                <!-- Carte Âge Moyen -->
                <div class="stat-card primary hover-lift">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3>Âge Moyen</h3>
                        <p class="stat-value" th:text="${averageAge}">0</p>
                        <span class="stat-unit">ans</span>
                    </div>
                </div>

                <!-- Carte Budget Moyen -->
                <div class="stat-card success hover-lift">
                    <div class="stat-icon">
                        <i class="fas fa-euro-sign"></i>
                    </div>
                    <div class="stat-info">
                        <h3>Budget Moyen</h3>
                        <p class="stat-value" th:text="${#numbers.formatDecimal(averageBudgetMoyen, 0, 'COMMA', 0, 'POINT')}">0</p>
                        <span class="stat-unit">Ar</span>
                    </div>
                </div>

                <!-- Carte Prix Estimation -->
                <div class="stat-card warning hover-lift">
                    <div class="stat-icon">
                        <i class="fas fa-tag"></i>
                    </div>
                    <div class="stat-info">
                        <h3>Prix Moyen Estimé</h3>
                        <p class="stat-value" th:text="${#numbers.formatDecimal(averageEstimationPrixProduit, 0, 'COMMA', 0, 'POINT')}">0</p>
                        <span class="stat-unit">Ar</span>
                    </div>
                </div>

                <!-- Carte Total Clients -->
                <div class="stat-card info hover-lift">
                    <div class="stat-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <div class="stat-info">
                        <h3>Total Personnes</h3>
                        <p class="stat-value" th:text="${#lists.size(marketingList)}">0</p>
                        <span class="stat-unit">enquêtés</span>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="content-grid" style="grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                <!-- Graphique Répartition par Genre -->
                <div class="chart-card hover-glow">
                    <div class="card-header">
                        <h3><i class="fas fa-venus-mars"></i> Répartition par Genre</h3>
                    </div>
                    <div class="chart-content" style="padding: 2rem;">
                        <div class="gender-chart">
                            <div class="pie-chart-simple"
                                 th:style="'--men-percentage:' + ${pourcentageHommes}">
                            </div>
                            <div class="chart-legend">
                                <div class="legend-item">
                                    <span class="legend-color men-color"></span>
                                    <span>Hommes</span>
                                    <span class="percentage">
                                        <span th:text="${#numbers.formatDecimal(pourcentageHommes, 1, 'POINT', 1, 'POINT')}">0</span>%
                                    </span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-color women-color"></span>
                                    <span>Femmes</span>
                                    <span class="percentage">
                                        <span th:text="${#numbers.formatDecimal(pourcentageFemmes, 1, 'POINT', 1, 'POINT')}">0</span>%
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lieux Populaires -->
                <div class="chart-card hover-glow">
                    <div class="card-header">
                        <h3><i class="fas fa-map-marker-alt"></i> Lieux Populaires</h3>
                    </div>
                    <div class="chart-content" style="padding: 2rem;">
                        <div class="progress-bars" id="lieuxChart">
                            <div th:each="entry : ${lieuxCounts}" class="progress-item">
                                <span class="progress-label" th:text="${entry.key.nom}">Lieu</span>
                                <div class="progress-bar">
                                    <div class="progress-fill lieu"
                                         th:style="'width:' + (${entry.value} * 10) + '%'">
                                    </div>
                                </div>
                                <span class="progress-value" th:text="${entry.value + ' votes'}">0 votes</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Produits Populaires -->
            <div class="chart-card hover-glow" style="margin-bottom: 2rem;">
                <div class="card-header">
                    <h3><i class="fas fa-coffee"></i> Produits Populaires</h3>
                </div>
                <div class="chart-content" style="padding: 2rem;">
                    <div class="progress-bars" id="produitsChart">
                        <div th:each="entry : ${produitsCounts}" class="progress-item">
                            <span class="progress-label" th:text="${entry.key.nom}">Produit</span>
                            <div class="progress-bar">
                                <div class="progress-fill produit" 
                                     th:style="'width:' + (${entry.value} * 10) + '%'"></div>
                            </div>
                            <span class="progress-value" th:text="${entry.value + ' votes'}">0 votes</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tableau de données détaillées -->
            <div class="table-container">
                <div style="padding: 1.5rem 2rem; border-bottom: 1px solid rgba(139, 69, 19, 0.1); background: rgba(139, 69, 19, 0.05);">
                    <h3 style="margin: 0; display: flex; align-items: center; gap: 0.75rem;">
                        <i class="fas fa-table"></i>
                        Données Détaillées Marketing
                        <span style="font-size: 0.8rem; background: var(--primary-color); color: white; padding: 0.25rem 0.75rem; border-radius: 12px;"
                              th:text="${#lists.size(marketingList)} + ' réponses'">0 réponses</span>
                    </h3>
                    <p style="margin: 0.5rem 0 0 0; font-size: 0.875rem; color: var(--gray-600);">
                        Détail des réponses collectées lors de l'enquête marketing
                    </p>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th><i class="fas fa-hashtag"></i> ID</th>
                            <th><i class="fas fa-venus-mars"></i> Genre</th>
                            <th><i class="fas fa-map-marker-alt"></i> Lieu</th>
                            <th><i class="fas fa-coffee"></i> Produit</th>
                            <th><i class="fas fa-birthday-cake"></i> Âge</th>
                            <th><i class="fas fa-euro-sign"></i> Budget Moyen</th>
                            <th><i class="fas fa-tag"></i> Prix Estimé</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:if="${#lists.isEmpty(marketingList)}">
                            <td colspan="7" style="text-align: center; padding: 3rem; color: var(--gray-500);">
                                <i class="fas fa-info-circle" style="font-size: 2rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                                <p style="margin: 0;">Aucune donnée marketing disponible</p>
                            </td>
                        </tr>
                        <tr th:each="m : ${marketingList}">
                            <td>
                                <span th:text="${m.id}" class="badge secondary">#</span>
                            </td>
                            <td>
                                <span class="badge" 
                                      th:text="${m.genre.valeur}"
                                      th:class="${m.genre.valeur == 'Homme'} ? 'badge info' : 'badge warning'"></span>
                            </td>
                            <td>
                                <i class="fas fa-map-marker-alt" style="color: var(--primary-color); margin-right: 0.5rem;"></i>
                                <span th:text="${m.lieu.nom}">Lieu</span>
                            </td>
                            <td>
                                <i class="fas fa-coffee" style="color: var(--primary-color); margin-right: 0.5rem;"></i>
                                <span th:text="${m.produit.nom}">Produit</span>
                            </td>
                            <td>
                                <span th:text="${m.age}" class="badge success"></span>
                            </td>
                            <td style="text-align: right;">
                                <span th:text="${#numbers.formatDecimal(m.budgetMoyen, 0, 'COMMA', 0, 'POINT')}" 
                                      style="font-weight: 600; color: var(--success-color);"></span> Ar
                            </td>
                            <td style="text-align: right;">
                                <span th:text="${#numbers.formatDecimal(m.estimationPrixProduit, 0, 'COMMA', 0, 'POINT')}" 
                                      style="font-weight: 600; color: var(--warning-color);"></span> Ar
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <script th:src="@{/js/marketing/dashboard.js}"></script>
    <script th:src="@{/templates/script.js}"></script>
</body>
</html>
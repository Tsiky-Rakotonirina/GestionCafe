<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Gestion des recrutements - CafeManager Pro</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" th:href="@{/templates/styles.css}">
    <link rel="stylesheet" th:href="@{/css/rh/recrutement.css}">
    <style>
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(30px);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .header-content {
            flex: 1;
        }
        
        .page-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
        }
        
        .page-subtitle {
            color: var(--gray-600);
            margin: 0;
            font-size: 1rem;
        }
        
        .header-actions {
            display: flex;
            gap: 0.75rem;
        }
        
        .btn {
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            font-weight: 500;
            text-decoration: none;
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }
        
        .btn-outline-secondary {
            background: transparent;
            color: var(--gray-700);
            border: 1px solid var(--gray-300);
        }
        
        .btn-outline-secondary:hover {
            background: var(--gray-100);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .me-1 {
            margin-right: 0.25rem;
        }
        
        .me-2 {
            margin-right: 0.5rem;
        }
        
        @media (max-width: 768px) {
            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .header-actions {
                width: 100%;
                justify-content: flex-end;
            }
        }
    </style>
</head>

<body>
    <div th:replace="~{administratif/rh/layout/sidebar :: sidebar}"></div>

    <div class="main-content" id="mainContent">
        <div th:replace="~{administratif/rh/layout/header :: header('Gestion des recrutements')}"></div>
        
        <main class="content">
            <!-- Page Header with Back Button -->
            <div class="page-header">
                <div class="header-content">
                    <h1 class="page-title">
                        <i class="fas fa-user-plus me-2"></i>
                        Gestion des Recrutements
                    </h1>
                    <p class="page-subtitle">Filtrer et recruter de nouveaux candidats</p>
                </div>
                <div class="header-actions">
                    <a href="/administratif/rh" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-1"></i> Retour RH
                    </a>
                </div>
            </div>

            <!-- Section des filtres -->
            <div class="filter-section">
                <h2><i class="fas fa-filter"></i> Filtrer les candidats</h2>
                <form class="form-recrutement" method="post" th:action="@{/administratif/rh/recrutement/recrutement}">
                    <!-- Genre (select) -->
                    <div class="filter-group">
                        <label><i class="fas fa-venus-mars"></i> Genre</label>
                        <select name="genreId" class="select-input">
                            <option value="" th:selected="${param.genreId == null or param.genreId == ''}">Tous les genres</option>
                            <option th:each="g : ${genres}" th:value="${g.id}" th:text="${g.nom}"
                                th:selected="${param.genreId == g.id.toString()}"></option>
                        </select>
                    </div>

                    <!-- Âge -->
                    <div class="filter-group">
                        <label><i class="fas fa-birthday-cake"></i> Âge</label>
                        <div class="age-inputs">
                            <input type="number" name="minAge" min="0" placeholder="Min" th:value="${param.minAge}" />
                            <span>à</span>
                            <input type="number" name="maxAge" min="0" placeholder="Max" th:value="${param.maxAge}" />
                            <span>ans</span>
                        </div>
                    </div>

                    <!-- Poste -->
                    <div class="filter-group">
                        <label><i class="fas fa-briefcase"></i> Poste recherché</label>
                        <select name="gradeId" class="select-input">
                            <option value="" th:selected="${param.gradeId == null or param.gradeId == ''}">Tous les postes</option>
                            <option th:each="g : ${grades}" th:value="${g.id}" th:text="${g.nom}"
                                th:selected="${param.gradeId == g.id.toString()}"></option>
                        </select>
                    </div>

                    <!-- Série Bac -->
                    <div class="filter-group">
                        <label><i class="fas fa-graduation-cap"></i> Série du Bac</label>
                        <div class="checkbox-group">
                            <label th:each="s : ${seriesBac}" class="checkbox-item">
                                <input type="checkbox" name="serieBacIds" th:value="${s.id}"
                                    th:checked="${param.serieBacIds != null} ? ${#lists.contains(param.serieBacIds, s.id.toString())} : false" />
                                <span th:text="${s.valeur}"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Bouton de filtrage -->
                    <div class="filter-submit">
                        <button type="submit" class="btn-filter">
                            <i class="fas fa-search"></i>
                            Filtrer les candidats
                        </button>
                    </div>
                </form>
            </div>

            <!-- Section des candidats -->
            <div class="candidates-section">
                <div class="candidates-header">
                    <h1>
                        <i class="fas fa-users"></i> 
                        Candidats
                        <span class="candidates-count" th:text="${#lists.size(candidats ?: {})}">0</span>
                    </h1>
                </div>

                <div th:if="${candidats != null and !#lists.isEmpty(candidats)}" class="cv-container">
                    <div class="cv-card" th:each="candidat : ${candidats}">
                        <!-- En-tête de la carte -->
                        <div class="cv-header">
                            <div th:if="${candidat.image != null}">
                                <img th:src="@{'/uploads/employe/' + ${candidat.image}}" alt="Photo" class="cv-photo" />
                            </div>
                            <div th:unless="${candidat.image != null}" class="cv-photo-placeholder" 
                                 th:text="${#strings.substring(candidat.nom,0,1)}">C</div>
                            
                            <div class="cv-actions">
                                <form class="form-recruter" th:action="@{/administratif/rh/recrutement/pdf}" method="post">
                                    <input type="hidden" name="candidatId" th:value="${candidat.id}" />
                                    <button type="submit" class="btn-pdf">
                                        <i class="fas fa-file-pdf"></i>
                                        PDF
                                    </button>
                                </form>
                            </div>
                        </div>

                        <!-- Informations principales -->
                        <div class="cv-main">
                            <h3 th:text="${candidat.nom}">Nom du candidat</h3>
                            
                            <div class="cv-info-grid">
                                <div class="cv-info-item">
                                    <span class="cv-info-label"><i class="fas fa-venus-mars"></i> Genre:</span>
                                    <span class="cv-info-value" th:text="${candidat.genre?.nom ?: '-'}">-</span>
                                </div>
                                
                                <div class="cv-info-item">
                                    <span class="cv-info-label"><i class="fas fa-birthday-cake"></i> Naissance:</span>
                                    <span class="cv-info-value" th:text="${candidat.dateNaissance != null ? #dates.format(candidat.dateNaissance, 'dd/MM/yyyy') : '-'}">-</span>
                                </div>
                                
                                <div class="cv-info-item">
                                    <span class="cv-info-label"><i class="fas fa-calendar-plus"></i> Candidature:</span>
                                    <span class="cv-info-value" th:text="${candidat.dateCandidature != null ? #dates.format(candidat.dateCandidature, 'dd/MM/yyyy') : '-'}">-</span>
                                </div>
                                
                                <div class="cv-info-item">
                                    <span class="cv-info-label"><i class="fas fa-phone"></i> Contact:</span>
                                    <span class="cv-info-value" th:text="${candidat.contact ?: '-'}">-</span>
                                </div>
                                
                                <div class="cv-info-item">
                                    <span class="cv-info-label"><i class="fas fa-briefcase"></i> Poste:</span>
                                    <span class="cv-info-value" th:text="${candidat.grade?.nom ?: '-'}">-</span>
                                </div>
                                
                                <div th:if="${candidat.grade?.salaire != null}" class="cv-info-item">
                                    <span class="cv-info-label"><i class="fas fa-money-bill-wave"></i> Salaire:</span>
                                    <span class="cv-info-value salary-highlight" 
                                          th:text="${#numbers.formatDecimal(candidat.grade.salaire, 1, 'COMMA', 2, 'POINT')} + ' Ar'">0 Ar</span>
                                </div>
                            </div>
                        </div>

                        <!-- Détails complémentaires -->
                        <div class="cv-details">
                            <h4><i class="fas fa-info-circle"></i> Qualifications</h4>
                            
                            <div class="details-grid">
                                <div class="detail-item">
                                    <span class="detail-label"><i class="fas fa-graduation-cap"></i> Bac:</span>
                                    <div class="detail-value">
                                        <div class="tags">
                                            <span th:each="d : ${detailsMap[candidat.id]}" th:if="${d.serieBac != null}" 
                                                  class="tag" th:text="${d.serieBac.valeur}"></span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="detail-item">
                                    <span class="detail-label"><i class="fas fa-university"></i> Formation:</span>
                                    <div class="detail-value">
                                        <div class="tags">
                                            <span th:each="d : ${detailsMap[candidat.id]}" th:if="${d.formation != null}" 
                                                  class="tag" th:text="${d.formation.valeur}"></span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="detail-item">
                                    <span class="detail-label"><i class="fas fa-language"></i> Langues:</span>
                                    <div class="detail-value">
                                        <div class="tags">
                                            <span th:each="d : ${detailsMap[candidat.id]}" th:if="${d.langue != null}" 
                                                  class="tag" th:text="${d.langue.valeur}"></span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="detail-item">
                                    <span class="detail-label"><i class="fas fa-chart-line"></i> Expérience:</span>
                                    <div class="detail-value">
                                        <div class="tags">
                                            <span th:each="d : ${detailsMap[candidat.id]}" th:if="${d.experience != null}" 
                                                  class="tag" th:text="${d.experience.valeur}"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Pied de carte avec action -->
                        <div class="cv-footer">
                            <form th:action="@{/administratif/rh/recrutement/recruter}" method="post">
                                <input type="hidden" name="candidatId" th:value="${candidat.id}" />
                                <button type="submit" class="btn-recruter">
                                    <i class="fas fa-user-plus"></i>
                                    Recruter ce candidat
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- État vide -->
                <div th:if="${candidats == null or #lists.isEmpty(candidats)}" class="empty-state">
                    <i class="fas fa-user-slash"></i>
                    <h3>Aucun candidat trouvé</h3>
                    <p>Essayez de modifier vos critères de recherche</p>
                </div>
            </div>
        </main>
    </div>
    
    <script>
        // Animation d'entrée pour les cartes
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.cv-card');
            cards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    card.style.transition = 'opacity 0.4s ease, transform 0.4s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 100);
            });
        });
    </script>
</body>

</html>
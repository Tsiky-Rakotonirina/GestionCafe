<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CafeManager Pro - Gestion de Café</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/templates/styles.css}">
    <link rel="stylesheet" th:href="@{/css/rh/historique.css}">
    <link rel="stylesheet" th:href="@{/css/rh/commission.css}">
    <script th:src="@{/js/rh/commission.js}"></script>
</head>
<body>
    <div th:replace="~{administratif/rh/layout/sidebar :: sidebar}"></div>
    <div class="main-content" id="mainContent">
        <div th:replace="~{administratif/rh/layout/header :: header('Gestion des commissions')}"></div>
        <main class="content">
            <div class="commission-container">
                                <!-- Employee Profile Card -->
                <div class="employee-profile-card">
                    <div class="employee-header">
                        <div class="employee-avatar">
                            <img th:src="${employe.image != null ? '/static/uploads/' + employe.image : ''}"
                                 alt="Photo de profil" class="avatar-img" th:if="${employe.image != null}">
                            <span th:if="${employe.image == null}" th:text="${#strings.substring(employe.nom, 0, 1)}">E</span>
                        </div>
                        <div class="employee-info">
                            <h4 class="employee-name">
                                <i class="fas fa-user me-2"></i>
                                <span th:text="${employe.nom != null ? employe.nom : 'Nom non défini'}">Nom de l'employé</span>
                            </h4>
                            <div class="employee-details">
                                <div class="detail-item">
                                    <i class="fas fa-calendar-alt text-primary"></i>
                                    <span class="detail-label">Recrutement :</span>
                                    <span class="detail-value" th:text="${employe.dateRecrutement != null ? #dates.format(employe.dateRecrutement, 'dd/MM/yyyy') : '-'}">-</span>
                                </div>
                                <div class="detail-item">
                                    <i class="fas fa-venus-mars text-info"></i>
                                    <span class="detail-label">Genre :</span>
                                    <span class="detail-value" th:text="${employe.genre != null ? employe.genre.nom : '-'}">-</span>
                                </div>
                                <div class="detail-item">
                                    <i class="fas fa-phone text-success"></i>
                                    <span class="detail-label">Contact :</span>
                                    <span class="detail-value" th:text="${employe.contact != null ? employe.contact : '-'}">-</span>
                                </div>
                            </div>
                        </div>
                        <div class="employee-actions">
                            <a th:href="@{'/administratif/rh/fiche-employe/' + ${employe.id}}" class="btn btn-primary">
                                <i class="fas fa-user-circle me-1"></i> Fiche Employé
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Commission Section -->
                <div class="commission-section">
                    <!-- Commission Form -->
                    <div class="commission-form-card">
                        <div class="form-header">
                            <h3><i class="fas fa-award"></i> Accorder une commission</h3>
                        </div>

                        <form th:action="@{/administratif/rh/salaire/ajout-commission}" method="post" class="commission-form">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-money-bill-wave me-1"></i> Montant de la commission
                                </label>
                                <input type="number" class="form-input" placeholder="Ex : 50 000" name="montant"
                                       min="0" step="100" required>
                                <small class="form-help">Saisissez le montant en Ariary</small>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-info-circle me-1"></i> Raison de la commission
                                </label>
                                <select class="form-select" name="idRaison" required>
                                    <option value="">Choisir une raison...</option>
                                    <option th:each="raisonCommission : ${raisonCommissions}"
                                            th:value="${raisonCommission.id}"
                                            th:text="${raisonCommission.valeur}">
                                        Raison
                                    </option>
                                </select>
                            </div>
                            
                            <input type="hidden" name="idEmploye" th:value="${employe.id}">
                            <button type="submit" class="btn-submit">
                                <i class="fas fa-check-circle"></i>
                                Accorder la commission
                            </button>
                        </form>
                    </div>

                    <!-- Commission Statistics -->
                    <div class="commission-stats-card">
                        <div class="stats-header">
                            <h3><i class="fas fa-chart-pie"></i> Statistiques</h3>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-icon">
                                    <i class="fas fa-award"></i>
                                </div>
                                <div class="stat-value" th:text="${#lists.size(commissions ?: {})}">0</div>
                                <div class="stat-label">Commissions accordées</div>
                            </div>
                            
                            <div class="stat-item">
                                <div class="stat-icon">
                                    <i class="fas fa-calculator"></i>
                                </div>
                                <div class="stat-value" th:text="${commissions != null ? #aggregates.sum(commissions.![montant]) + ' Ar' : '0 Ar'}">0 Ar</div>
                                <div class="stat-label">Total des commissions</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Commission History -->
                <div class="commission-history-card">
                    <div class="history-header">
                        <h3><i class="fas fa-history"></i> Historique des commissions</h3>
                    </div>
                    
                    <div th:if="${commissions != null and !#lists.isEmpty(commissions)}">
                        <table class="history-table">
                            <thead>
                                <tr>
                                    <th><i class="fas fa-calendar me-1"></i> Date</th>
                                    <th><i class="fas fa-money-bill-wave me-1"></i> Montant</th>
                                    <th><i class="fas fa-info-circle me-1"></i> Raison</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="commission : ${commissions}">
                                    <td class="date-cell" th:text="${commission.dateCommission != null ? #dates.format(commission.dateCommission, 'dd/MM/yyyy') : '-'}">-</td>
                                    <td class="amount-cell" th:text="${commission.montant != null ? #numbers.formatDecimal(commission.montant, 0, 'COMMA', 2, 'POINT') + ' Ar' : '-'}">-</td>
                                    <td class="reason-cell">
                                        <span class="reason-badge" th:text="${commission.raisonCommission != null ? commission.raisonCommission.valeur : 'Non spécifiée'}">-</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div th:if="${commissions == null or #lists.isEmpty(commissions)}" class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-award"></i>
                        </div>
                        <h4>Aucune commission accordée</h4>
                        <p>Aucune commission n'a encore été accordée à cet employé</p>
                    </div>
                </div>

                <!-- Error Messages -->
                <div th:if="${erreurAjoutCommission}" class="error-message">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span th:text="${erreurAjoutCommission}">Erreur lors de l'ajout de la commission</span>
                </div>
            </div>
        </main>
    </div>
</body>
</html>
